# ğŸ†“ å®Œå…¨å…è´¹éƒ¨ç½²æ–¹æ¡ˆè¯¦è§£

## ğŸ’° æˆæœ¬å¯¹æ¯”åˆ†æ

### å¾®ä¿¡äº‘å¼€å‘ï¼ˆæŒ‰é‡ä»˜è´¹ï¼‰
- **äº‘å‡½æ•°**: Â¥0.000016/æ¬¡ (100ä¸‡æ¬¡ = Â¥16)
- **äº‘å­˜å‚¨**: Â¥0.0043/GB/å¤© (5GB = Â¥65/æœˆ)
- **äº‘æ•°æ®åº“**: Â¥0.07/GB/å¤© (2GB = Â¥420/æœˆ)
- **æœˆå‡æˆæœ¬**: Â¥100-500å…ƒ

### è‡ªå»ºå…è´¹æ–¹æ¡ˆ
- **æœåŠ¡å™¨**: Â¥0 (Vercel/Netlifyå…è´¹é¢åº¦)
- **æ•°æ®åº“**: Â¥0 (MongoDB Atlaså…è´¹512MB)
- **AIæ¨¡å‹**: Â¥0 (å¼€æºUÂ²-Net)
- **æœˆå‡æˆæœ¬**: Â¥0å…ƒ

## ğŸš€ æ¨èå…è´¹éƒ¨ç½²æ–¹æ¡ˆ

### æ–¹æ¡ˆA: Vercel + MongoDB Atlas (å¼ºçƒˆæ¨è)

**ä¼˜åŠ¿:**
- âœ… å®Œå…¨å…è´¹ï¼Œç”Ÿäº§çº§åˆ«
- âœ… è‡ªåŠ¨éƒ¨ç½²ï¼ŒGité›†æˆ
- âœ… å…¨çƒCDNåŠ é€Ÿ
- âœ… è‡ªå®šä¹‰åŸŸåæ”¯æŒ
- âœ… 100,000æ¬¡å‡½æ•°è°ƒç”¨/æœˆ

**éƒ¨ç½²æ­¥éª¤:**

1. **åˆ›å»ºVercelé¡¹ç›®**
```bash
# å®‰è£…Vercel CLI
npm i -g vercel

# ç™»å½•Vercel
vercel login

# éƒ¨ç½²é¡¹ç›®
cd clothing-match-app/api
vercel --prod
```

2. **é…ç½®MongoDB Atlas**
```bash
# åˆ›å»ºå…è´¹é›†ç¾¤
# 1. è®¿é—® https://www.mongodb.com/atlas
# 2. é€‰æ‹©å…è´¹M0é›†ç¾¤
# 3. è·å–è¿æ¥å­—ç¬¦ä¸²
```

3. **éƒ¨ç½²åç«¯API**
```javascript
// vercel.json
{
  "version": 2,
  "builds": [
    {
      "src": "api/**/*.js",
      "use": "@vercel/node"
    }
  ],
  "env": {
    "MONGODB_URI": "@mongodb-uri",
    "NODE_ENV": "production"
  }
}
```

### æ–¹æ¡ˆB: Netlify + Supabase

**ä¼˜åŠ¿:**
- âœ… ç•Œé¢å‹å¥½ï¼Œæ˜“ä¸Šæ‰‹
- âœ… åŒ…å«è®¤è¯æœåŠ¡
- âœ… å®æ—¶æ•°æ®åº“
- âœ… å‡½æ•°è°ƒç”¨æ— é™åˆ¶

**éƒ¨ç½²æ­¥éª¤:**
```bash
# å®‰è£…Netlify CLI
npm i -g netlify-cli

# éƒ¨ç½²
netlify deploy --prod --dir=api
```

### æ–¹æ¡ˆC: Railway + è‡ªå»ºæ•°æ®åº“

**ä¼˜åŠ¿:**
- âœ… åŒ…å«æ•°æ®åº“æœåŠ¡
- âœ… æ”¯æŒDockeréƒ¨ç½²
- âœ… å…è´¹é¢åº¦$5/æœˆ

## ğŸ”§ åç«¯APIä»£ç 

### ä¸»è¦APIç«¯ç‚¹

```javascript
// api/remove-background.js - AIæŠ å›¾
// api/recommend.js - æ™ºèƒ½æ¨è  
// api/clothing.js - è¡£ç‰©ç®¡ç†
// api/outfits.js - æ­é…ç®¡ç†
// api/upload.js - æ–‡ä»¶ä¸Šä¼ 
// api/health.js - å¥åº·æ£€æŸ¥
```

### å®Œæ•´APIç¤ºä¾‹

```javascript
// api/clothing.js
const express = require('express');
const multer = require('multer');
const { MongoClient } = require('mongodb');

const router = express.Router();
const upload = multer({ storage: multer.memoryStorage() });

// è¿æ¥MongoDB
let db;
MongoClient.connect(process.env.MONGODB_URI, {
  useNewUrlParser: true,
  useUnifiedTopology: true
}).then(client => {
  db = client.db('clothing-app');
  console.log('MongoDBè¿æ¥æˆåŠŸ');
});

// è·å–è¡£ç‰©åˆ—è¡¨
router.get('/', async (req, res) => {
  try {
    const { page = 1, limit = 20, category } = req.query;
    const skip = (page - 1) * limit;
    
    const filter = category ? { category } : {};
    const clothing = await db.collection('clothing')
      .find(filter)
      .skip(skip)
      .limit(parseInt(limit))
      .sort({ createTime: -1 })
      .toArray();
    
    const total = await db.collection('clothing').countDocuments(filter);
    
    res.json({
      success: true,
      data: clothing,
      total,
      page: parseInt(page),
      limit: parseInt(limit)
    });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});

// æ·»åŠ è¡£ç‰©
router.post('/', upload.single('image'), async (req, res) => {
  try {
    const { name, category, tags } = req.body;
    const image = req.file;
    
    if (!name || !category) {
      return res.status(400).json({
        success: false,
        error: 'åç§°å’Œåˆ†ç±»ä¸èƒ½ä¸ºç©º'
      });
    }
    
    const clothing = {
      name,
      category,
      tags: tags ? tags.split(',') : [],
      image: `/uploads/${image.filename}`,
      createTime: new Date(),
      _openid: req.user?.openid || 'demo-user' // å®é™…é¡¹ç›®ä¸­éœ€è¦è®¤è¯ä¸­é—´ä»¶
    };
    
    const result = await db.collection('clothing').insertOne(clothing);
    
    res.json({
      success: true,
      data: { ...clothing, _id: result.insertedId }
    });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});

// åˆ é™¤è¡£ç‰©
router.delete('/:id', async (req, res) => {
  try {
    const result = await db.collection('clothing').deleteOne({
      _id: new ObjectId(req.params.id)
    });
    
    if (result.deletedCount === 0) {
      return res.status(404).json({
        success: false,
        error: 'è¡£ç‰©ä¸å­˜åœ¨'
      });
    }
    
    res.json({ success: true });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});

module.exports = router;
```

## ğŸ¯ å°ç¨‹åºé…ç½®ä¿®æ”¹

### ä¿®æ”¹APIé…ç½®æ–‡ä»¶

```javascript
// miniprogram/config/api.js
module.exports = {
  DEPLOY_MODE: 'self-hosted', // æ”¹ä¸ºè‡ªå»ºæ¨¡å¼
  SELF_HOSTED_CONFIG: {
    baseURL: 'https://your-app.vercel.app/api', // æ‚¨çš„APIåœ°å€
    timeout: 30000
  }
};
```

### ä¿®æ”¹é¡µé¢è°ƒç”¨æ–¹å¼

```javascript
// åœ¨éœ€è¦APIè°ƒç”¨çš„é¡µé¢ä¸­
const hybridService = require('../../services/hybrid.js');

// è·å–è¡£ç‰©åˆ—è¡¨
async loadClothingData() {
  try {
    const result = await hybridService.getClothingList();
    this.setData({
      clothing: result.data
    });
  } catch (error) {
    wx.showToast({
      title: 'åŠ è½½å¤±è´¥',
      icon: 'error'
    });
  }
}
```

## ğŸ“‹ å…è´¹é¢åº¦ç›‘æ§

### Vercelç›‘æ§
```javascript
// åˆ›å»ºç›‘æ§è„šæœ¬
async function checkVercelUsage() {
  const response = await fetch('https://api.vercel.com/v4/usage');
  const usage = await response.json();
  
  console.log(`å‡½æ•°è°ƒç”¨: ${usage.invocations}/${usage.invocationsLimit}`);
  console.log(`å¸¦å®½ä½¿ç”¨: ${usage.bandwidth.all}/${usage.bandwidthLimit}`);
  
  // å¦‚æœæ¥è¿‘é™é¢ï¼Œå‘é€è­¦å‘Š
  if (usage.invocations / usage.invocationsLimit > 0.8) {
    sendWarning('Vercelå‡½æ•°è°ƒç”¨å³å°†è¾¾åˆ°é™é¢');
  }
}
```

### MongoDBç›‘æ§
```javascript
// æ£€æŸ¥å­˜å‚¨ä½¿ç”¨æƒ…å†µ
async function checkMongoUsage() {
  // MongoDB Atlas APIè·å–ä½¿ç”¨æƒ…å†µ
  const stats = await getAtlasStats();
  
  console.log(`æ•°æ®å­˜å‚¨: ${stats.storage}MB / 512MB`);
  console.log(`æ•°æ®ä¼ è¾“: ${stats.transfer}GB / 10GB`);
}
```

## ğŸ”’ å®‰å…¨é…ç½®

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# Vercelç¯å¢ƒå˜é‡
vercel env add MONGODB_URI
vercel env add JWT_SECRET
vercel env add API_SECRET_KEY

# æœ¬åœ°å¼€å‘
# .env.local
MONGODB_URI=mongodb+srv://user:pass@cluster.mongodb.net/clothing
JWT_SECRET=your-secret-key
API_SECRET_KEY=your-api-key
```

### APIå®‰å…¨é…ç½®
```javascript
// middleware/auth.js
const jwt = require('jsonwebtoken');

function authenticateToken(req, res, next) {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ error: 'ç¼ºå°‘è®¤è¯ä»¤ç‰Œ' });
  }

  jwt.verify(token, process.env.JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ error: 'ä»¤ç‰Œæ— æ•ˆ' });
    }
    req.user = user;
    next();
  });
}

module.exports = { authenticateToken };
```

## ğŸŒ åŸŸåé…ç½®

### Vercelè‡ªå®šä¹‰åŸŸå
```bash
# æ·»åŠ è‡ªå®šä¹‰åŸŸå
vercel domains add your-api.clothing-app.com

# é…ç½®DNSè®°å½•
# CNAME -> cname.vercel-dns.com
```

### å°ç¨‹åºåŸŸåç™½åå•
```json
// project.config.json
{
  "setting": {
    "urlCheck": false,
    "es6": true,
    "postcss": true,
    "minified": true
  },
  "requiredPrivateInfos": [
    "chooseLocation"
  ]
}
```

## ğŸš¨ æ•…éšœè½¬ç§»æœºåˆ¶

### è‡ªåŠ¨åˆ‡æ¢é€»è¾‘
```javascript
// services/hybrid.js ä¸­çš„æ•…éšœè½¬ç§»
async function failoverToBackup() {
  console.log('ä¸»æœåŠ¡ä¸å¯ç”¨ï¼Œå¯åŠ¨æ•…éšœè½¬ç§»...');
  
  // 1. å°è¯•å¤‡ç”¨API
  const backupResponse = await callBackupAPI();
  if (backupResponse.success) {
    return backupResponse;
  }
  
  // 2. åˆ‡æ¢åˆ°äº‘å¼€å‘æ¨¡å¼
  await switchToCloudMode();
  
  // 3. é€šçŸ¥ç”¨æˆ·
  wx.showModal({
    title: 'æœåŠ¡åˆ‡æ¢',
    content: 'å·²åˆ‡æ¢åˆ°å¤‡ç”¨æœåŠ¡ï¼ŒåŠŸèƒ½å¯èƒ½å—é™',
    showCancel: false
  });
}
```

## ğŸ“ˆ æ‰©å±•æ–¹æ¡ˆ

### å½“å…è´¹é¢åº¦ä¸è¶³æ—¶çš„é€‰æ‹©

1. **å‡çº§åˆ°ä»˜è´¹æ–¹æ¡ˆ**
   - Vercel Pro: $20/æœˆ
   - MongoDB Atlas M10: $57/æœˆ

2. **å¤šæœåŠ¡è´Ÿè½½å‡è¡¡**
   - ä¸»æœåŠ¡: Vercel
   - å¤‡ç”¨æœåŠ¡: Netlify
   - å­˜å‚¨æœåŠ¡: äº‘å¼€å‘

3. **è¾¹ç¼˜è®¡ç®—ä¼˜åŒ–**
   - ä½¿ç”¨Cloudflare Workers
   - å‡å°‘APIè°ƒç”¨æ¬¡æ•°
   - æœ¬åœ°ç¼“å­˜ä¼˜åŒ–

---

**æ€»ç»“**: é€šè¿‡è‡ªå»ºAPI + å…è´¹æœåŠ¡ï¼Œå®Œå…¨å¯ä»¥å°†æˆæœ¬é™è‡³Â¥0ï¼ŒåŒæ—¶ä¿æŒç”Ÿäº§çº§åˆ«çš„æœåŠ¡è´¨é‡ï¼