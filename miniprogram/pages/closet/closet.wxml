<view class="page-container theme-{{currentSeason}}">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <view class="toolbar">
    <view class="toolbar-left">
      <text class="page-title">æˆ‘çš„è¡£æ©±</text>
    </view>
    <view class="toolbar-right">
      <button class="btn-icon" bindtap="showFilterModal">
        <text class="icon">ğŸ”</text>
      </button>
      <button class="btn-icon" bindtap="showSortModal">
        <text class="icon">â†•ï¸</text>
      </button>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <scroll-view class="category-scroll" scroll-x="true">
    <view class="category-item {{selectedCategory === '' ? 'active' : ''}}" bindtap="selectCategory" data-category="">
      <text>å…¨éƒ¨</text>
      <text class="count">{{categoryStats.all}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'top' ? 'active' : ''}}" bindtap="selectCategory" data-category="top">
      <text>ä¸Šè¡£</text>
      <text class="count">{{categoryStats.top}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'bottom' ? 'active' : ''}}" bindtap="selectCategory" data-category="bottom">
      <text>ä¸‹è£…</text>
      <text class="count">{{categoryStats.bottom}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'dress' ? 'active' : ''}}" bindtap="selectCategory" data-category="dress">
      <text>è£™å­</text>
      <text class="count">{{categoryStats.dress}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'outerwear' ? 'active' : ''}}" bindtap="selectCategory" data-category="outerwear">
      <text>å¤–å¥—</text>
      <text class="count">{{categoryStats.outerwear}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'shoes' ? 'active' : ''}}" bindtap="selectCategory" data-category="shoes">
      <text>é‹å­</text>
      <text class="count">{{categoryStats.shoes}}</text>
    </view>
    <view class="category-item {{selectedCategory === 'accessory' ? 'active' : ''}}" bindtap="selectCategory" data-category="accessory">
      <text>é…é¥°</text>
      <text class="count">{{categoryStats.accessory}}</text>
    </view>
  </scroll-view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- è¡£ç‰©åˆ—è¡¨ -->
    <scroll-view class="clothing-list" scroll-y="true" bindscrolltolower="loadMoreClothing">
      <view class="clothing-grid">
        <view class="clothing-item" wx:for="{{filteredClothing}}" wx:key="id" bindtap="selectClothing" data-item="{{item}}">
          <view class="clothing-image-container">
            <image class="clothing-image" src="{{item.image}}" mode="aspectFill" />
            <view class="clothing-overlay">
              <button class="btn-overlay btn-select" bindtap="toggleSelect" data-id="{{item.id}}" catchtap="true">
                <text class="icon">{{item.selected ? 'âœ“' : ''}}</text>
              </button>
              <button class="btn-overlay btn-edit" bindtap="editClothing" data-id="{{item.id}}" catchtap="true">
                <text class="icon">âœï¸</text>
              </button>
              <button class="btn-overlay btn-delete" bindtap="deleteClothing" data-id="{{item.id}}" catchtap="true">
                <text class="icon">ğŸ—‘ï¸</text>
              </button>
            </view>
          </view>
          <view class="clothing-info">
            <text class="clothing-name">{{item.name}}</text>
            <view class="clothing-tags">
              <text class="tag-small" wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag">{{tag}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{filteredClothing.length === 0}}">
        <image src="/images/empty-closet.png" mode="aspectFit" />
        <text class="empty-text">è¡£æ©±è¿˜æ˜¯ç©ºçš„</text>
        <button class="btn btn-primary" bindtap="showAddModal">æ·»åŠ ç¬¬ä¸€ä»¶è¡£ç‰©</button>
      </view>
    </scroll-view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar" wx:if="{{selectedItems.length > 0}}">
    <text class="selected-count">å·²é€‰æ‹© {{selectedItems.length}} ä»¶</text>
    <button class="btn btn-primary" bindtap="createOutfit">åˆ›å»ºæ­é…</button>
  </view>

  <!-- æ·»åŠ è¡£ç‰©å¼¹çª— -->
  <modal class="add-modal" wx:if="{{showAddModal}}" bindtap="hideAddModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ è¡£ç‰©</text>
        <button class="btn-close" bindtap="hideAddModal">Ã—</button>
      </view>
      
      <view class="modal-body">
        <!-- æ·»åŠ æ–¹å¼é€‰æ‹© -->
        <view class="add-methods">
          <button class="method-btn" bindtap="chooseFromAlbum">
            <text class="method-icon">ğŸ“·</text>
            <text>ä»ç›¸å†Œé€‰æ‹©</text>
          </button>
          <button class="method-btn" bindtap="takePhoto">
            <text class="method-icon">ğŸ“¸</text>
            <text>æ‹ç…§ä¸Šä¼ </text>
          </button>
        </view>

        <!-- è¡£ç‰©ä¿¡æ¯è¡¨å• -->
        <view class="clothing-form" wx:if="{{tempClothing.image}}">
          <image class="preview-image" src="{{tempClothing.image}}" mode="aspectFill" />
          
          <view class="form-group">
            <text class="form-label">è¡£ç‰©åç§°</text>
            <input class="form-input" placeholder="è¯·è¾“å…¥è¡£ç‰©åç§°" bindinput="onNameInput" value="{{tempClothing.name}}" />
          </view>

          <view class="form-group">
            <text class="form-label">åˆ†ç±»</text>
            <picker bindchange="onCategoryChange" value="{{categoryIndex}}" range="{{categories}}">
              <view class="picker">{{categories[categoryIndex]}}</view>
            </picker>
          </view>

          <view class="form-group">
            <text class="form-label">æ ‡ç­¾</text>
            <view class="tag-input-area">
              <view class="selected-tags">
                <text class="tag-small" wx:for="{{tempClothing.tags}}" wx:key="*this" wx:for-item="tag">
                  {{tag}} Ã—
                </text>
              </view>
              <input class="tag-input" placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦" bindconfirm="addTag" />
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="hideAddModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="saveClothing" wx:if="{{tempClothing.image}}">ä¿å­˜</button>
      </view>
    </view>
  </modal>
</view>